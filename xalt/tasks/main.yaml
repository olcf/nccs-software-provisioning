- name: Create XALT Configuration Directory
  ansible.builtin.file:
    path: "{{ [NSP_install_root, 'xalt/etc'] | path_join }}"
    state: directory
    owner: "{{ NSP_user }}"
    group: "{{ NSP_group }}"
    mode: "{{ NSP_executable_permissions }}"
  tags:
    - xalt

- name: Generate XALT config.py
  ansible.builtin.template:
    src: "{{ [playbook_dir, 'xalt/config.py.j2'] | path_join }}"
    dest: "{{ [NSP_install_root, 'xalt/etc/config.py'] | path_join }}"
    owner: "{{ NSP_user }}"
    group: "{{ NSP_group }}"
    mode: "{{ NSP_file_permissions }}"
  tags:
    - xalt

- name: Copy Kafka Certs
  ansible.builtin.copy:
    src: "{{ [playbook_dir, 'xalt', item] | path_join }}"
    dest: "{{ [NSP_install_root, 'xalt/etc', item] | path_join }}"
    owner: "{{ NSP_user }}"
    group: "{{ NSP_group }}"
    mode: "{{ NSP_file_permissions }}"
  loop:
    - cacerts.pem
    - fullchain.pem
  tags:
    - xalt

- name: Launch XALT ({{ NSP_XALT_git_reference }}) Install
  ansible.builtin.include_tasks:
    file: install.yaml
  tags:
    - xalt

- name: Create XALT Module Directory
  ansible.builtin.file:
    path: "{{ [NSP_module_root, 'xalt'] | path_join }}"
    state: directory
    owner: "{{ NSP_user }}"
    group: "{{ NSP_group }}"
    mode: "{{ NSP_executable_permissions }}"
  when: NSP_XALT_create_module
  tags:
    - xalt

- name: Generate XALT ({{ NSP_XALT_git_reference }}) Module File
  ansible.builtin.template:
    src: module.lua.j2
    dest: "{{ [NSP_module_root, 'xalt', '{}.lua'.format(NSP_XALT_module_version)] | path_join }}"
    owner: "{{ NSP_user }}"
    group: "{{ NSP_group }}"
    mode: "{{ NSP_file_permissions }}"
  when: NSP_XALT_create_module
  tags:
    - xalt
